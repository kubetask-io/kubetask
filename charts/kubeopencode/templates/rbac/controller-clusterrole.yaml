apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: {{ include "kubeopencode.fullname" . }}-controller
  labels:
    {{- include "kubeopencode.controller.labels" . | nindent 4 }}
rules:
# KubeOpenCode CRs
- apiGroups:
  - kubeopencode.io
  resources:
  - agents
  - contexts
  - cronworkflows
  - kubeopencodeconfigs
  - tasks
  - tasktemplates
  - webhooktriggers
  - workflows
  - workflowruns
  verbs:
  - get
  - list
  - watch
  - create
  - update
  - patch
  - delete
# KubeOpenCode CR status
- apiGroups:
  - kubeopencode.io
  resources:
  - agents/status
  - contexts/status
  - cronworkflows/status
  - kubeopencodeconfigs/status
  - tasks/status
  - tasktemplates/status
  - webhooktriggers/status
  - workflows/status
  - workflowruns/status
  verbs:
  - get
  - update
  - patch
# ConfigMaps and Secrets (full access for task context)
- apiGroups:
  - ""
  resources:
  - configmaps
  - secrets
  verbs:
  - get
  - list
  - watch
  - create
  - update
  - patch
  - delete
# Events
- apiGroups:
  - ""
  resources:
  - events
  verbs:
  - create
  - patch
# Pods (for task execution)
- apiGroups:
  - ""
  resources:
  - pods
  verbs:
  - get
  - list
  - watch
  - create
  - update
  - patch
  - delete
# Services (for Server-mode Agents)
- apiGroups:
  - ""
  resources:
  - services
  verbs:
  - get
  - list
  - watch
  - create
  - update
  - patch
  - delete
# Deployments (for Server-mode Agents)
- apiGroups:
  - apps
  resources:
  - deployments
  verbs:
  - get
  - list
  - watch
  - create
  - update
  - patch
  - delete
# Leader election
- apiGroups:
  - coordination.k8s.io
  resources:
  - leases
  verbs:
  - get
  - list
  - watch
  - create
  - update
  - patch
  - delete
