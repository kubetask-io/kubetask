---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    controller-gen.kubebuilder.io/version: v0.16.5
  name: batches.kubetask.io
spec:
  group: kubetask.io
  names:
    kind: Batch
    listKind: BatchList
    plural: batches
    singular: batch
  scope: Namespaced
  versions:
  - additionalPrinterColumns:
    - jsonPath: .metadata.creationTimestamp
      name: Age
      type: date
    name: v1alpha1
    schema:
      openAPIV3Schema:
        description: |-
          Batch defines a task batch template that specifies WHAT to do and WHERE to do it.
          Batch is AI-agnostic and works with any agent.
        properties:
          apiVersion:
            description: |-
              APIVersion defines the versioned schema of this representation of an object.
              Servers should convert recognized schemas to the latest internal value, and
              may reject unrecognized values.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources
            type: string
          kind:
            description: |-
              Kind is a string value representing the REST resource this object represents.
              Servers may infer this from the endpoint the client submits requests to.
              Cannot be updated.
              In CamelCase.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds
            type: string
          metadata:
            type: object
          spec:
            description: Spec defines the desired state of Batch
            properties:
              agentRef:
                description: |-
                  AgentRef references an Agent for this Batch.
                  If not specified, uses the "default" Agent in the same namespace.
                type: string
              commonContext:
                description: |-
                  CommonContext - contexts shared across all tasks (the constant part)
                  These contexts are included in every task
                items:
                  description: |-
                    Context represents different types of task inputs
                    This is a polymorphic type that can represent File, API, Database, etc.
                  properties:
                    file:
                      description: File context (required when Type == "File")
                      properties:
                        filePath:
                          description: |-
                            FilePath is the full path where this file will be mounted in the agent pod.
                            Multiple contexts with the same FilePath will be aggregated into a single file.
                            Example: "/workspace/task.md", "/workspace/config/settings.json"
                          type: string
                        source:
                          description: File content source (exactly one must be specified)
                          properties:
                            configMapKeyRef:
                              description: Reference to a key in a ConfigMap
                              properties:
                                key:
                                  description: Key of the ConfigMap to select from
                                  type: string
                                name:
                                  description: Name of the ConfigMap
                                  type: string
                                optional:
                                  description: Specify whether the ConfigMap must
                                    be defined
                                  type: boolean
                              required:
                              - key
                              - name
                              type: object
                            inline:
                              description: Inline content
                              type: string
                            secretKeyRef:
                              description: Reference to a key in a Secret
                              properties:
                                key:
                                  description: Key of the secret to select from
                                  type: string
                                name:
                                  description: Name of the secret
                                  type: string
                                optional:
                                  description: Specify whether the Secret must be
                                    defined
                                  type: boolean
                              required:
                              - key
                              - name
                              type: object
                          type: object
                      required:
                      - filePath
                      - source
                      type: object
                    remoteFile:
                      description: RemoteFile context (required when Type == "RemoteFile")
                      properties:
                        filePath:
                          description: |-
                            FilePath is the full path where this file will be mounted in the agent pod.
                            Multiple contexts with the same FilePath will be aggregated into a single file.
                            Example: "/workspace/task.md", "/workspace/CLAUDE.md"
                          type: string
                        headers:
                          description: |-
                            Headers specifies optional HTTP headers to include in the request.
                            Useful for authentication (e.g., Authorization header for private repos).
                          items:
                            description: HTTPHeader represents an HTTP header key-value
                              pair
                            properties:
                              name:
                                description: Name is the header name (e.g., "Authorization",
                                  "Accept")
                                type: string
                              value:
                                description: |-
                                  Value is the header value.
                                  For sensitive values, use ValueFrom instead.
                                type: string
                              valueFrom:
                                description: ValueFrom references a secret for sensitive
                                  header values.
                                properties:
                                  key:
                                    description: Key of the secret to select from
                                    type: string
                                  name:
                                    description: Name of the secret
                                    type: string
                                  optional:
                                    description: Specify whether the Secret must be
                                      defined
                                    type: boolean
                                required:
                                - key
                                - name
                                type: object
                            required:
                            - name
                            type: object
                          type: array
                        url:
                          description: |-
                            URL is the HTTP/HTTPS URL to fetch the file from.
                            For GitHub files, use raw URLs like:
                              https://raw.githubusercontent.com/owner/repo/branch/path/to/file
                          type: string
                      required:
                      - filePath
                      - url
                      type: object
                    type:
                      description: 'Type of context: File, RemoteFile, API, Database,
                        etc.'
                      enum:
                      - File
                      - RemoteFile
                      type: string
                  required:
                  - type
                  type: object
                type: array
              variableContexts:
                description: |-
                  VariableContexts - variable contexts that differ per task (the variable part)
                  Each item is a list of contexts for one task
                  Task[i] = commonContext (constant) + variableContexts[i] (variable)
                  Total tasks = len(variableContexts)

                  Example:
                    commonContext: [task.md, guide.md]  // constant - same for all tasks
                    variableContexts: [                 // variable - different per task
                      [repo1:main, repo1-config.json],  // task 1's variable part
                      [repo2:main, repo2-config.json],  // task 2's variable part
                    ]
                    Generates 2 tasks:
                      Task 1 = [task.md, guide.md] + [repo1:main, repo1-config.json]
                      Task 2 = [task.md, guide.md] + [repo2:main, repo2-config.json]
                items:
                  description: ContextSet represents a set of contexts for one task
                  items:
                    description: |-
                      Context represents different types of task inputs
                      This is a polymorphic type that can represent File, API, Database, etc.
                    properties:
                      file:
                        description: File context (required when Type == "File")
                        properties:
                          filePath:
                            description: |-
                              FilePath is the full path where this file will be mounted in the agent pod.
                              Multiple contexts with the same FilePath will be aggregated into a single file.
                              Example: "/workspace/task.md", "/workspace/config/settings.json"
                            type: string
                          source:
                            description: File content source (exactly one must be
                              specified)
                            properties:
                              configMapKeyRef:
                                description: Reference to a key in a ConfigMap
                                properties:
                                  key:
                                    description: Key of the ConfigMap to select from
                                    type: string
                                  name:
                                    description: Name of the ConfigMap
                                    type: string
                                  optional:
                                    description: Specify whether the ConfigMap must
                                      be defined
                                    type: boolean
                                required:
                                - key
                                - name
                                type: object
                              inline:
                                description: Inline content
                                type: string
                              secretKeyRef:
                                description: Reference to a key in a Secret
                                properties:
                                  key:
                                    description: Key of the secret to select from
                                    type: string
                                  name:
                                    description: Name of the secret
                                    type: string
                                  optional:
                                    description: Specify whether the Secret must be
                                      defined
                                    type: boolean
                                required:
                                - key
                                - name
                                type: object
                            type: object
                        required:
                        - filePath
                        - source
                        type: object
                      remoteFile:
                        description: RemoteFile context (required when Type == "RemoteFile")
                        properties:
                          filePath:
                            description: |-
                              FilePath is the full path where this file will be mounted in the agent pod.
                              Multiple contexts with the same FilePath will be aggregated into a single file.
                              Example: "/workspace/task.md", "/workspace/CLAUDE.md"
                            type: string
                          headers:
                            description: |-
                              Headers specifies optional HTTP headers to include in the request.
                              Useful for authentication (e.g., Authorization header for private repos).
                            items:
                              description: HTTPHeader represents an HTTP header key-value
                                pair
                              properties:
                                name:
                                  description: Name is the header name (e.g., "Authorization",
                                    "Accept")
                                  type: string
                                value:
                                  description: |-
                                    Value is the header value.
                                    For sensitive values, use ValueFrom instead.
                                  type: string
                                valueFrom:
                                  description: ValueFrom references a secret for sensitive
                                    header values.
                                  properties:
                                    key:
                                      description: Key of the secret to select from
                                      type: string
                                    name:
                                      description: Name of the secret
                                      type: string
                                    optional:
                                      description: Specify whether the Secret must
                                        be defined
                                      type: boolean
                                  required:
                                  - key
                                  - name
                                  type: object
                              required:
                              - name
                              type: object
                            type: array
                          url:
                            description: |-
                              URL is the HTTP/HTTPS URL to fetch the file from.
                              For GitHub files, use raw URLs like:
                                https://raw.githubusercontent.com/owner/repo/branch/path/to/file
                            type: string
                        required:
                        - filePath
                        - url
                        type: object
                      type:
                        description: 'Type of context: File, RemoteFile, API, Database,
                          etc.'
                        enum:
                        - File
                        - RemoteFile
                        type: string
                    required:
                    - type
                    type: object
                  type: array
                type: array
            required:
            - commonContext
            - variableContexts
            type: object
        type: object
    served: true
    storage: true
    subresources: {}
