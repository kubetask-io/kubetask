apiVersion: kubetask.io/v1alpha1
kind: WebhookTrigger
metadata:
  name: github-pr-review-only
spec:
  auth:
    hmac:
      secretRef:
        name: github-webhook-secret
        key: hmacKey
      signatureHeader: X-Hub-Signature-256
      algorithm: sha256
  matchPolicy: First
  rules:
    - name: pr-opened
      filter: |
        headers["x-github-event"] == "pull_request" &&
        body.action == "opened"
      resourceTemplate:
        task:
          agentRef: default
          description: |
            Review this Pull Request and post your review as a comment:

            Repository: {{ .repository.full_name }}
            Author: {{ .sender.login }}

            PR #{{ .pull_request.number }}: {{ .pull_request.title }}
            PR URL: {{ .pull_request.html_url }}
            PR Body: {{ .pull_request.body }}

            ## Instructions

            1. Clone the repository and checkout the PR branch
            2. Review the code changes thoroughly
            3. Prepare a constructive review with:
               - Summary of changes
               - Code quality observations
               - Suggestions for improvement (if any)
               - Overall assessment
            4. Post your review as a PR comment.
