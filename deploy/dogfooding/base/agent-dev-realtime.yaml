# Copyright Contributors to the KubeTask project
# Agent configuration for AI agent with humanInTheLoop enabled for development
apiVersion: kubetask.io/v1alpha1
kind: Agent
metadata:
  name: dev-realtime
spec:
  agentImage: quay.io/kubetask/kubetask-agent-gemini:latest
  workspaceDir: /workspace
  command:
    - sh
    - -c
    - gemini --output-format stream-json --yolo -p "$(cat ${WORKSPACE_DIR}/task.md)"
  serviceAccountName: kubetask-agent
  credentials:
    - name: gemini
      secretRef:
        name: gemini-credentials
  # Agent-level contexts (lowest priority, applied to all tasks)
  contexts:
    - ref:
        name: basic-rules
  # Enable human-in-the-loop for development and debugging
  humanInTheLoop:
    image: quay.io/kubetask/kubetask-agent-code-server:latest
    command:
      - sh
      - -c
      - code-server --bind-addr 0.0.0.0:8080 --auth none ${WORKSPACE_DIR} & sleep 7200
    ports:
      - name: code-server
        containerPort: 8080
    sidecar:
      enabled: true
